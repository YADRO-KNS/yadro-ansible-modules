---
- name: Test required parameters | Ensure TestUser absent
  yadro.obmc.bmc_account:
    connection: "{{ connection }}"
    username: "TestUser"
    state: "absent"


- name: Test required parameters | Create TestUser without required arguments
  yadro.obmc.bmc_account:
    connection: "{{ connection }}"
    username: "TestUser"
    state: "present"
  register: result
  ignore_errors: true

- name: Test required parameters | Check error raised
  assert:
    that:
      - "result.failed == true"
      - "result.changed == false"
      - "result.msg == 'Cannot create new account.'"
      - "result.error_info == 'Fields required: password, role, enabled.'"
